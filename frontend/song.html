<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Link Lab - Music Discovery</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 50%, #0a0a0a 100%);
    color: white;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 20% 80%, rgba(138, 43, 226, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(30, 215, 96, 0.1) 0%, transparent 50%);
    animation: pulseBackground 8s ease-in-out infinite;
    pointer-events: none;
  }

  @keyframes pulseBackground {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 0.8; }
  }

  /* Navbar */
  .navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.2rem 3rem;
    background: rgba(15, 15, 25, 0.95);
    backdrop-filter: blur(20px);
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid rgba(30, 215, 96, 0.3);
    box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
  }

  .navbar h2 {
    margin: 0;
    font-size: 2.2rem;
    background: linear-gradient(135deg, #1ed760, #8a2be2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 800;
    letter-spacing: 2px;
    text-shadow: 0 2px 10px rgba(30, 215, 96, 0.3);
    position: relative;
  }

  .navbar h2::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, #1ed760, transparent);
    border-radius: 2px;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .nav-links button, .nav-links select, #searchInput {
    background: rgba(51, 51, 71, 0.8);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 0.8rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
  }

  .nav-links button::before, .nav-links select::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
  }

  .nav-links button:hover::before, .nav-links select:hover::before {
    left: 100%;
  }

  .nav-links button:hover, .nav-links select:hover, #searchInput:focus {
    background: rgba(75, 75, 95, 0.9);
    transform: translateY(-2px);
    border-color: rgba(30, 215, 96, 0.5);
    box-shadow: 0 8px 25px rgba(30, 215, 96, 0.2);
  }

  #searchInput {
    width: 280px;
    background: rgba(40, 40, 60, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 0.9rem 1.5rem;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  #searchInput:focus {
    outline: none;
    border-color: #1ed760;
    box-shadow: 0 0 0 2px rgba(30, 215, 96, 0.3);
    background: rgba(50, 50, 70, 0.95);
  }

  /* Prominent Recommendations button */
  #recommendBtn {
    background: linear-gradient(135deg, #1ed760 0%, #1db954 100%);
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 0.9rem 2rem;
    border-radius: 12px;
    border: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(30, 215, 96, 0.4);
  }

  #recommendBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  #recommendBtn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 35px rgba(30, 215, 96, 0.6);
  }

  #recommendBtn:hover::before {
    left: 100%;
  }

  /* Songs grid */
  .songs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 2rem;
    padding: 3rem;
    max-width: 1400px;
    margin: 2rem auto;
    position: relative;
    z-index: 1;
  }

  .song-card {
    cursor: pointer;
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    background: rgba(30, 30, 50, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  .song-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(30, 215, 96, 0.1), rgba(138, 43, 226, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1;
    border-radius: 16px;
  }

  .song-card:hover::before {
    opacity: 1;
  }

  .song-card img {
    width: 100%;
    height: 220px;
    display: block;
    border-radius: 16px;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .song-card:hover {
    transform: translateY(-15px) scale(1.05);
    box-shadow: 
      0 25px 50px rgba(30, 215, 96, 0.3),
      0 0 0 1px rgba(30, 215, 96, 0.2);
    border-color: rgba(30, 215, 96, 0.5);
  }

  .song-card:hover img {
    transform: scale(1.1);
  }

  .song-info {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.95));
    padding: 1.5rem 1rem 1rem;
    z-index: 2;
    transition: all 0.3s ease;
  }

  .song-card:hover .song-info {
    background: linear-gradient(transparent, rgba(30, 215, 96, 0.3));
    padding-bottom: 1.3rem;
  }

  .song-title {
    font-weight: 600;
    font-size: 1rem;
    letter-spacing: 0.5px;
    margin-bottom: 0.3rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .song-artist {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #1ed760, #1db954);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    z-index: 3;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(30, 215, 96, 0.5);
  }

  .song-card:hover .play-button {
    transform: translate(-50%, -50%) scale(1);
  }

  .play-button::after {
    content: 'â–¶';
    margin-left: 3px;
  }

  .genre-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: linear-gradient(135deg, #8a2be2, #6a0dad);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 2;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
  }

  .song-card:hover .genre-badge {
    transform: scale(1.1) rotate(-5deg);
  }

  /* Add to playlist button */
  .add-playlist-btn {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(30, 215, 96, 0.9);
    color: white;
    padding: 0.5rem;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    z-index: 2;
    opacity: 0;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(30, 215, 96, 0.5);
    cursor: pointer;
  }

  .song-card:hover .add-playlist-btn {
    opacity: 1;
  }

  .add-playlist-btn:hover {
    background: rgba(30, 215, 96, 1);
    transform: scale(1.2) rotate(90deg);
  }

  /* Floating animation for cards */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  .song-card:nth-child(odd) {
    animation: float 6s ease-in-out infinite;
  }

  .song-card:nth-child(even) {
    animation: float 6s ease-in-out infinite 1s;
  }

  /* Loading spinner */
  .loading {
    text-align: center;
    padding: 3rem;
    font-size: 1.2rem;
    color: #1ed760;
  }

  .spinner {
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-top: 4px solid #1ed760;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 2rem auto;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .songs-grid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1.5rem;
      padding: 2rem;
    }
  }

  @media (max-width: 768px) {
    .navbar {
      padding: 1rem 1.5rem;
      flex-direction: column;
      gap: 1rem;
    }

    .nav-links {
      flex-wrap: wrap;
      justify-content: center;
    }

    #searchInput {
      width: 200px;
    }

    .songs-grid {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      padding: 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .navbar h2 {
      font-size: 1.8rem;
    }

    .nav-links {
      gap: 1rem;
    }

    .nav-links button, .nav-links select, #searchInput {
      padding: 0.7rem 1rem;
      font-size: 0.9rem;
    }

    #searchInput {
      width: 150px;
    }

    .songs-grid {
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      padding: 1rem;
    }

    .song-card img {
      height: 180px;
    }
  }
</style>
</head>
<body>

<div class="navbar">
  <h2>ðŸŽµ Link Lab</h2>
  <div class="nav-links">
    <button id="recommendBtn">Recommendations</button>
    <button onclick="loadSongs('top')">Top Charts</button>
    <button onclick="loadSongs('trending')">Trending</button>
    <button onclick="loadSongs('new')">New Releases</button>
    <button id="playlistBtn">My Playlist</button>
    <select id="genreSelect" onchange="loadGenreSongs(this.value)">
      <option value="">Select Genre</option>
      <option value="rock">Rock</option>
      <option value="pop">Pop</option>
      <option value="jazz">Jazz</option>
      <option value="classical">Classical</option>
      <option value="electronic">Electronic</option>
      <option value="hip-hop">Hip Hop</option>
      <option value="country">Country</option>
      <option value="r-n-b">R&B</option>
    </select>
    <input type="text" id="searchInput" placeholder="Search songs..." oninput="filterSongs()"/>
  </div>
</div>

<div class="songs-grid" id="songsGrid"></div>

<script>
// Using iTunes API (free, no API key required, better CORS support)
const API_BASE = 'https://itunes.apple.com';
let allSongs = [];
let currentQuery = 'top';

// Map genres to search terms
const genreMap = {
  'rock': 'rock',
  'pop': 'pop',
  'jazz': 'jazz',
  'classical': 'classical',
  'electronic': 'electronic',
  'hip-hop': 'hip hop',
  'country': 'country',
  'r-n-b': 'r&b soul'
};

// Load songs by category
async function loadSongs(category) {
  const grid = document.getElementById('songsGrid');
  grid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading amazing tracks...</div>';
  
  currentQuery = category;
  let searchTerm = '';
  
  switch(category) {
    case 'top':
      searchTerm = 'trending';
      break;
    case 'trending':
      searchTerm = 'popular';
      break;
    case 'new':
      searchTerm = 'new music';
      break;
    default:
      searchTerm = 'music';
  }
  
  try {
    const response = await fetch(`${API_BASE}/search?term=${encodeURIComponent(searchTerm)}&media=music&entity=song&limit=50`);
    const data = await response.json();
    
    if (data.results && data.results.length > 0) {
      allSongs = data.results.map(track => ({
        id: track.trackId,
        title: track.trackName,
        artist: track.artistName,
        album: track.collectionName,
        cover: track.artworkUrl100.replace('100x100', '300x300'),
        preview: track.previewUrl,
        genre: track.primaryGenreName || 'Music',
        price: track.trackPrice,
        releaseDate: track.releaseDate,
        duration: track.trackTimeMillis
      }));
      
      displaySongs(allSongs);
    } else {
      grid.innerHTML = '<div class="loading">No songs found. Try a different search.</div>';
    }
  } catch (error) {
    console.error('Error fetching songs:', error);
    grid.innerHTML = '<div class="loading">Failed to load songs. Please check your internet connection.</div>';
  }
}

// Load songs by genre
async function loadGenreSongs(genre) {
  if (!genre) return;
  
  const grid = document.getElementById('songsGrid');
  grid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading tracks...</div>';
  
  const searchTerm = genreMap[genre] || genre;
  
  try {
    const response = await fetch(`${API_BASE}/search?term=${encodeURIComponent(searchTerm)}&media=music&entity=song&limit=50`);
    const data = await response.json();
    
    if (data.results && data.results.length > 0) {
      allSongs = data.results.map(track => ({
        id: track.trackId,
        title: track.trackName,
        artist: track.artistName,
        album: track.collectionName,
        cover: track.artworkUrl100.replace('100x100', '300x300'),
        preview: track.previewUrl,
        genre: genre.charAt(0).toUpperCase() + genre.slice(1).replace('-', ' '),
        price: track.trackPrice,
        releaseDate: track.releaseDate,
        duration: track.trackTimeMillis
      }));
      
      displaySongs(allSongs);
    } else {
      grid.innerHTML = '<div class="loading">No songs found for this genre.</div>';
    }
  } catch (error) {
    console.error('Error fetching genre songs:', error);
    grid.innerHTML = '<div class="loading">Failed to load songs. Please try again.</div>';
  }
}

// Display songs
function displaySongs(songs) {
  const grid = document.getElementById('songsGrid');
  grid.innerHTML = '';
  
  if (songs.length === 0) {
    grid.innerHTML = '<div class="loading">No songs found.</div>';
    return;
  }
  
  // Store songs in localStorage for details page access
  localStorage.setItem('currentSongs', JSON.stringify(songs));
  
  songs.forEach(song => {
    const card = document.createElement('div');
    card.className = 'song-card';
    card.innerHTML = `
      <img src="${song.cover}" alt="${song.title}" onerror="this.src='https://via.placeholder.com/300x300/1a1a2e/1ed760?text=No+Image'">
      <div class="play-button"></div>
      <div class="add-playlist-btn" onclick="addToPlaylist(event, ${song.id})">+</div>
      <div class="genre-badge">${song.genre}</div>
      <div class="song-info">
        <div class="song-title">${song.title}</div>
        <div class="song-artist">${song.artist}</div>
      </div>
    `;
    
    card.addEventListener('click', (e) => {
      if (!e.target.classList.contains('add-playlist-btn')) {
        window.location.href = `song_details.html?id=${song.id}`;
      }
    });
    
    grid.appendChild(card);
  });
}

// Add to playlist
function addToPlaylist(event, songId) {
  event.stopPropagation();
  
  const song = allSongs.find(s => s.id === songId);
  if (!song) return;
  
  let playlist = JSON.parse(localStorage.getItem('playlist') || '[]');
  
  if (playlist.find(s => s.id === songId)) {
    showNotification('âš ï¸ Song already in playlist!');
    return;
  }
  
  playlist.push(song);
  localStorage.setItem('playlist', JSON.stringify(playlist));
  showNotification('âœ“ Added to Playlist: ' + song.title);
}

// Show notification helper
function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: linear-gradient(135deg, #8a2be2, #6a0dad);
    color: white;
    padding: 1rem 2rem;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(138, 43, 226, 0.5);
    z-index: 10000;
    font-weight: 600;
    animation: slideIn 0.3s ease;
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

// View playlist
document.getElementById('playlistBtn').addEventListener('click', () => {
  const playlist = JSON.parse(localStorage.getItem('playlist') || '[]');
  
  if (playlist.length === 0) {
    alert('Your playlist is empty. Add some songs!');
  } else {
    allSongs = playlist;
    displaySongs(allSongs);
  }
});

// Filter/search songs
function filterSongs() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  
  if (query.length === 0) {
    displaySongs(allSongs);
    return;
  }
  
  const filtered = allSongs.filter(song => 
    song.title.toLowerCase().includes(query) || 
    song.artist.toLowerCase().includes(query) ||
    song.album.toLowerCase().includes(query)
  );
  displaySongs(filtered);
}

// Search on Enter key
document.getElementById('searchInput').addEventListener('keypress', async (e) => {
  if (e.key === 'Enter') {
    const query = e.target.value.trim();
    if (query.length > 0) {
      const grid = document.getElementById('songsGrid');
      grid.innerHTML = '<div class="loading"><div class="spinner"></div>Searching...</div>';
      
      try {
        const response = await fetch(`${API_BASE}/search?term=${encodeURIComponent(query)}&media=music&entity=song&limit=50`);
        const data = await response.json();
        
        if (data.results && data.results.length > 0) {
          allSongs = data.results.map(track => ({
            id: track.trackId,
            title: track.trackName,
            artist: track.artistName,
            album: track.collectionName,
            cover: track.artworkUrl100.replace('100x100', '300x300'),
            preview: track.previewUrl,
            genre: track.primaryGenreName || 'Music',
            price: track.trackPrice,
            releaseDate: track.releaseDate,
            duration: track.trackTimeMillis
          }));
          
          displaySongs(allSongs);
        } else {
          grid.innerHTML = '<div class="loading">No songs found.</div>';
        }
      } catch (error) {
        console.error('Search error:', error);
        grid.innerHTML = '<div class="loading">Search failed. Please try again.</div>';
      }
    }
  }
});

// Recommendations button
document.getElementById('recommendBtn').addEventListener('click', () => {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const playlist = JSON.parse(localStorage.getItem('playlist') || '[]');
  const recommendations = JSON.parse(localStorage.getItem('recommendations') || '[]');
  
  if (playlist.length === 0 && recommendations.length === 0 && users.length === 0) {
    alert('Add songs to your playlist or mark songs as recommendations first to get personalized suggestions!');
    return;
  }
  
  // Count genre frequencies from all sources
  const genreCount = {};
  
  playlist.forEach(song => {
    if (song.genre) {
      genreCount[song.genre] = (genreCount[song.genre] || 0) + 1;
    }
  });
  
  recommendations.forEach(song => {
    if (song.genre) {
      genreCount[song.genre] = (genreCount[song.genre] || 0) + 2; // Weight recommendations higher
    }
  });
  
  users.forEach(user => {
    const musicPref = user?.preferences?.music;
    if (musicPref) {
      genreCount[musicPref] = (genreCount[musicPref] || 0) + 1;
    }
  });
  
  // Add genre preferences if available
  const genrePreferences = JSON.parse(localStorage.getItem('genrePreferences') || '{}');
  Object.keys(genrePreferences).forEach(genre => {
    genreCount[genre] = (genreCount[genre] || 0) + genrePreferences[genre];
  });
  
  if (Object.keys(genreCount).length === 0) {
    genreCount['Pop'] = 1;
    genreCount['Rock'] = 1;
  }
  
  // Build weighted graph
  const genresList = Object.keys(genreCount);
  const graph = {};
  genresList.forEach(g => graph[g] = []);
  
  for (let i = 0; i < genresList.length; i++) {
    for (let j = i + 1; j < genresList.length; j++) {
      const w = 1 + Math.abs(genreCount[genresList[i]] - genreCount[genresList[j]]);
      graph[genresList[i]].push({ to: genresList[j], weight: w });
      graph[genresList[j]].push({ to: genresList[i], weight: w });
    }
  }
  
  // Compute distances using Dijkstra-like algorithm
  const dist = {};
  genresList.forEach(g => dist[g] = Infinity);
  
  const source = genresList[0];
  dist[source] = 0;
  const stack = [source];
  
  while (stack.length > 0) {
    const current = stack.pop();
    graph[current].forEach(edge => {
      if (dist[current] + edge.weight < dist[edge.to]) {
        dist[edge.to] = dist[current] + edge.weight;
        stack.push(edge.to);
      }
    });
  }
  
  // Sort by distance (lower distance = higher priority)
  const orderedGenres = Object.entries(dist)
    .sort((a, b) => a[1] - b[1])
    .map(entry => entry[0]);
  
  // Load recommended genre
  if (orderedGenres.length > 0) {
    const topGenre = orderedGenres[0].toLowerCase();
    
    // Search for the top recommended genre
    const grid = document.getElementById('songsGrid');
    grid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading recommendations...</div>';
    
    fetch(`${API_BASE}/search?term=${encodeURIComponent(topGenre)}&media=music&entity=song&limit=50`)
      .then(response => response.json())
      .then(data => {
        if (data.results && data.results.length > 0) {
          allSongs = data.results.map(track => ({
            id: track.trackId,
            title: track.trackName,
            artist: track.artistName,
            album: track.collectionName,
            cover: track.artworkUrl100.replace('100x100', '300x300'),
            preview: track.previewUrl,
            genre: track.primaryGenreName || 'Music',
            price: track.trackPrice,
            releaseDate: track.releaseDate,
            duration: track.trackTimeMillis
          }));
          
          displaySongs(allSongs);
          
          showNotification(`ðŸŽµ Recommendations based on: ${orderedGenres.slice(0, 3).join(', ')}`);
        }
      })
      .catch(error => {
        console.error('Recommendation error:', error);
        grid.innerHTML = '<div class="loading">Failed to load recommendations.</div>';
      });
  }
});

// Initialize
loadSongs('top');
</script>

<script>
  document.getElementById("recommendBtn").addEventListener("click", function () {
    window.location.href = "songs_recommendations.html";
  });
</script>



</body>
</html>